<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculator Mini App</title>
<style>
    body { font-family: Arial, sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; background:#f0f0f0; }
    #calculator { background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2); }
    #display { width:100%; height:40px; text-align:right; font-size:24px; margin-bottom:10px; padding:5px; border:1px solid #ccc; border-radius:5px; }
    .btn { width:60px; height:60px; margin:5px; font-size:20px; cursor:pointer; }
    .row { display:flex; justify-content:center; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.12.0/math.min.js"></script>
</head>
<body>
<div id="calculator">
    <input type="text" id="display" value="0" readonly>
    <div class="row">
        <button class="btn" onclick="appendNumber('7')">7</button>
        <button class="btn" onclick="appendNumber('8')">8</button>
        <button class="btn" onclick="appendNumber('9')">9</button>
        <button class="btn" onclick="appendOperator('/')">รท</button>
    </div>
    <div class="row">
        <button class="btn" onclick="appendNumber('4')">4</button>
        <button class="btn" onclick="appendNumber('5')">5</button>
        <button class="btn" onclick="appendNumber('6')">6</button>
        <button class="btn" onclick="appendOperator('*')">ร</button>
    </div>
    <div class="row">
        <button class="btn" onclick="appendNumber('1')">1</button>
        <button class="btn" onclick="appendNumber('2')">2</button>
        <button class="btn" onclick="appendNumber('3')">3</button>
        <button class="btn" onclick="appendOperator('-')">-</button>
    </div>
    <div class="row">
        <button class="btn" onclick="appendNumber('0')">0</button>
        <button class="btn" onclick="appendNumber('.')">.</button>
        <button class="btn" onclick="calculateResult()">=</button>
        <button class="btn" onclick="appendOperator('+')">+</button>
    </div>
    <div class="row">
        <button class="btn" onclick="clearDisplay()" style="width:260px;">C</button>
    </div>
</div>

<script>
let display = document.getElementById('display');
let currentInput = '';

let tg = null;
if(window.Telegram && window.Telegram.WebApp){
    tg = window.Telegram.WebApp;
    tg.expand();
}

function appendNumber(num){
    currentInput += num;
    display.value = currentInput;
}

function appendOperator(op){
    if(currentInput === '') return; // don't start with operator
    let lastChar = currentInput.slice(-1);
    if("+-*/".includes(lastChar)) {
        // replace last operator with new one
        currentInput = currentInput.slice(0, -1) + op;
    } else {
        currentInput += op;
    }
    display.value = currentInput;
}

function clearDisplay(){
    currentInput = '';
    display.value = '0';
}

function calculateResult(){
    try{
        if(currentInput === '') return;
        let result = math.evaluate(currentInput).toString();
        display.value = result;
        currentInput = result; // allow further calculations
        if(tg) tg.sendData(result); // send result to Telegram bot
    } catch(err){
        display.value = 'Error';
        currentInput = '';
    }
}
</script>
</body>
</html>
